import{a as u,b as f}from"./chunk-U3RDBIDU.js";import{S as d,W as n,a as l,b as m,k as p,s as c}from"./chunk-6FH7UK33.js";var v=(()=>{class s{constructor(){this.request=n(u),this.lang=n(f),this.prosopoData$=new p(null),this.myLang="%20.%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22"+this.lang.selectedLang+"%22%2C%22en%22.%20%7D%0A%7D%0A"}sparqlBuilding(e){let a="https://database.factgrid.de/query/#SELECT%20DISTINCT%20%3Fitem%20%3FitemLabel%20%3FitemDescription%20%20%3Fname%20%3FnameLabel%20%3Fsociety%20%3FsocietyLabel%20%20WHERE%20%7B%20%3Fitem%20wdt%3AP131%20wd%3AQ99677%3B%20wdt%3AP2%20wd%3AQ7%3B%20wdt%3AP247%20%3Fname%20%20%20OPTIONAL%20%7B%20%3Fitem%20wdt%3AP91%20%3Fsociety%20.%20%3Fsociety%20wdt%3AP2%20wd%3AQ164221%20%7D"+e;return console.log(a),a}listFromSparql(e){if(e?.results?.bindings){let a=e.results.bindings.map(t=>({person:t.item?{id:t.item.value.replace("https://database.factgrid.de/entity/",""),label:t.itemLabel?.value??"",description:t.itemDescription?.value??""}:void 0,name:t.item?{id:t.name.value.replace("https://database.factgrid.de/entity/",""),label:t.nameLabel?.value??""}:void 0,society:t.society?{id:t.society.value.replace("https://database.factgrid.de/entity/",""),label:t.societyLabel?.value??""}:void 0}));return e.results.bindings=[],this.mergeDuplicatesByPersonId(a,"; ")}return[]}mergeDuplicatesByPersonId(e,a="; "){let t=new Map;for(let i of e){let r=i.person?.id;if(r)if(!t.has(r))t.set(r,m(l({},i),{name:i.name?l({},i.name):void 0}));else{let o=t.get(r);i.name?.id&&(o.name?.id?o.name.id+=a+i.name.id:o.name=l({},i.name)),i.name?.label&&(o.name?.label?o.name.label+=a+i.name.label:(o.name||(o.name={id:"",label:""}),o.name.label=i.name.label))}}return Array.from(t.values())}databaseToDisplay(e){return this.request.getList(e).pipe(c(a=>this.listFromSparql(a)))}loadProsopoData(e){this.databaseToDisplay(e).subscribe({next:a=>{this.prosopoData$.next(a),console.log("Cache mis \xE0 jour prosopoData$",this.prosopoData$.getValue())},error:a=>console.error("Erreur lors du chargement des donn\xE9es",a)})}getProsopoData(){return this.prosopoData$.asObservable()}newSparqlAdress(e){let a="https://database.factgrid.de/sparql?query=",t="https://database.factgrid.de/query/#";return e.includes("embed.html")&&(t="https://database.factgrid.de/query/embed.html#"),e!==void 0&&(e=e.replace(t,a)),e}databaseToDownload(e){let a=[["person.label","person.id","person.description","name.label","name.id","society.label","society.id"]];for(let t=0;t<e.length;t++)a[t+1]=[e[t].person.label,e[t].person.id,e[t].person.description,e[t].name.label,e[t].name.id,e[t].society.label,e[t].society.id];return a}initProsopoData(e){(!this.prosopoData$.getValue()||this.prosopoData$.getValue().length===0)&&this.loadProsopoData(e)}static{this.\u0275fac=function(a){return new(a||s)}}static{this.\u0275prov=d({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{v as a};
