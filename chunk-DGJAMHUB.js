import{P as b,T as s,k as c,pd as h,qd as p,r as d}from"./chunk-MW253N2G.js";var g=(()=>{let i=class i{constructor(){this.request=s(h),this.lang=s(p),this.biblioData$=new c(null),this.myLang="%20.%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22"+this.lang.selectedLang+"%22%2C%22en%22.%20%7D%0A%7D%0A"}sparqlBuilding(t,l,e){let u="https://database.factgrid.de/query/#",r=`
SELECT DISTINCT ?title ?titleLabel ?author ?authorLabel ?date ?location ?locationLabel ?country ?countryLabel
WHERE {
  VALUES ?c { wd:Q21925 wd:Q11317 }
  ?title wdt:P2 wd:Q20;
         wdt:P243 wd:Q172203;
         wdt:P21 ?author;
         wdt:P222 ?date;
         wdt:P241 ?location
  ${decodeURIComponent(t)}
`.trim();l!==void 0&&(r+=`
LIMIT ${l}`),e!==void 0&&e>0&&(r+=`
OFFSET ${e}`);let a=r.replace(/\n/g," ");return u+encodeURIComponent(a)}updateBiblioData(t){this.biblioData$.next(t)}listFromSparql(t){if(!t?.results?.bindings)return[];let l=t.results.bindings.map(a=>({author:a.author?{id:a.author.value.replace("https://database.factgrid.de/entity/",""),label:a.authorLabel?.value||""}:void 0,title:a.title?{id:a.title.value.replace("https://database.factgrid.de/entity/",""),label:a.titleLabel?.value||""}:void 0,location:a.location?{id:a.location.value.replace("https://database.factgrid.de/entity/",""),label:a.locationLabel?.value||""}:void 0,country:a.country?{id:a.country.value.replace("https://database.factgrid.de/entity/",""),label:a.countryLabel?.value||""}:void 0,date:{value:a.date?.value?a.date.value.slice(0,4):""}})),e=new Set,u=[];return l.filter(a=>{let o=a.title?.id?.trim();return o?e.has(o)?(u.push(a),!1):(e.add(o),!0):!0})}databaseToDisplay(t){return this.request.getList(t).pipe(d(l=>this.listFromSparql(l)))}loadBiblioData(t){this.databaseToDisplay(t).subscribe({next:l=>this.biblioData$.next(l),error:l=>console.error("Erreur lors du chargement des donn\xE9es",l)})}getBiblioData(){return this.biblioData$.asObservable()}getCurrentData(){return this.biblioData$.getValue()}newSparqlAdress(t){let l="https://database.factgrid.de/sparql?query=",e="https://database.factgrid.de/query/#";return t.includes("embed.html")&&(e="https://database.factgrid.de/query/embed.html#"),t!==void 0&&(t=t.replace(e,l)),t}databaseToDownload(t){let l=[["author","author.id","title","title.id","location","location.id","country","country.id","date"]];for(let e=0;e<t.length;e++)l[e+1]=[t[e].author.label,t[e].author.id,t[e].title.label,t[e].title.id,t[e].location.label,t[e].location.id,t[e].country.label,t[e].country.id,t[e].date.value];return l}initBiblioData(t){(!this.biblioData$.getValue()||this.biblioData$.getValue().length===0)&&this.loadBiblioData(t)}};i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=b({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();export{g as a};
