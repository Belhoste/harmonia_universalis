import{a as de}from"./chunk-XXXWLCKM.js";import{k as re}from"./chunk-7SWT5MIX.js";import{$ as me,I as X,J as Y,V as oe,Y as se,Z as le,_ as ce,b as z,f as G,i as H,k as Q,r as V,s as J}from"./chunk-XPHXKHTR.js";import{a as ne,b as ae}from"./chunk-U3RDBIDU.js";import{Ad as ie,C as P,Cb as q,Db as A,Eb as F,Jb as O,Ka as _,Kb as j,M as y,Ob as B,P as I,Pa as c,Ua as S,Va as R,W as v,Wa as b,Xa as E,Ya as i,Z as k,Za as n,Zb as U,_a as p,ac as $,cc as N,hb as u,p as w,rc as W,s as d,sc as K,tb as r,ub as C,ud as Z,v as L,vb as h,vd as ee,wa as D,xa as a,xd as te,y as T}from"./chunk-6FH7UK33.js";var ue=(t,l)=>l.id,pe=t=>["/item",t],he=()=>[""],ge=()=>["/prosopography"],fe=()=>["/harmonia_universalis"],ve=()=>["./advanced_search"];function _e(t,l){if(t&1&&(i(0,"div",11),r(1),n()),t&2){let e=u();a(),h(" ",e.warningMessage," ")}}function Se(t,l){if(t&1&&(i(0,"span"),r(1),n()),t&2){let e=u().$implicit;a(),h(", ",e.description,"")}}function Ae(t,l){if(t&1&&(i(0,"div")(1,"span",13),r(2),n(),i(3,"mat-icon-button",14)(4,"mat-icon",15),r(5,"open_in_new"),n()(),r(6,"\xA0\xA0\xA0 "),_(7,Se,2,1,"span"),p(8,"hr"),n()),t&2){let e=l.$implicit;a(2),h("",e.label,"\xA0"),a(),c("routerLink",F(4,pe,e.id)),a(),c("inline",!0),a(3),S(e.description?7:-1)}}function Ce(t,l){if(t&1&&(i(0,"div",10)(1,"div",12),b(2,Ae,9,6,"div",null,ue),n()()),t&2){let e=u();a(2),E(e.items)}}function xe(t,l){if(t&1&&(i(0,"span",23),r(1),i(2,"mat-icon-button",14)(3,"mat-icon",24),r(4,"open_in_new"),n()(),r(5,"\xA0\xA0\xA0\xA0\xA0 "),n()),t&2){let e=u().$implicit;a(),h(" ",e.label,"\xA0 "),a(),c("routerLink",F(3,pe,e.value.id)),a(),c("inline",!0)}}function ye(t,l){if(t&1&&(i(0,"div",22),_(1,xe,6,5,"span",23),p(2,"br"),n()),t&2){let e=l.$implicit;a(),S(e?1:-1)}}function Ie(t,l){if(t&1&&(i(0,"div")(1,"div",9)(2,"a",16),r(3,"Accueil"),n(),i(4,"span"),r(5,"\xA0\xA0|\xA0\xA0"),n(),i(6,"a",16),r(7,"Prosopographie"),n(),i(8,"span"),r(9,"\xA0\xA0|\xA0\xA0"),n(),i(10,"a",16),r(11,"Bibliographie"),n(),i(12,"span"),r(13,"\xA0\xA0|\xA0\xA0"),n(),i(14,"a",16),r(15),n(),i(16,"span"),r(17,"\xA0\xA0|\xA0\xA0"),n(),i(18,"a",17),r(19," Sparql query "),n(),i(20,"span"),r(21,"\xA0\xA0|\xA0\xA0"),n()(),i(22,"div",18)(23,"mat-card",19)(24,"div",20),r(25),n(),i(26,"div",21),p(27,"hr"),i(28,"mat-card-content")(29,"div"),b(30,ye,3,1,"div",22,R),n()()()()()()),t&2){let e=u();a(2),c("routerLink",A(6,he)),a(4),c("routerLink",A(7,ge)),a(4),c("routerLink",A(8,fe)),a(4),c("routerLink",A(9,ve)),a(),C(e.advanced_search),a(10),C(e.formerVisitsTitle),a(5),E(e.selectedItemsList)}}function be(t,l){let e=[];for(let o=0;o<t.length;o+=l)e.push(t.slice(o,o+l));return e}var Ke=(()=>{class t{constructor(){this.changeDetector=v(B),this.request=v(ne),this.setLanguage=v(de),this.lang=v(ae),this.title="harmoniaUniversalis",this.subtitle="a database on animal magnetism",this.advanced_search="advanced search",this.projects="research projects",this.fields="fields of reserach",this.warningMessage="",this.searchInput=new H,this.isDisplay=!1,this.items=[],this.selectedItemsList=JSON.parse(localStorage.getItem("selectedItems"))||[]}ngOnInit(){this.subtitle=this.lang.subtitle(this.subtitle),this.advanced_search=this.lang.advanced_search(this.advanced_search),this.projects=this.lang.projects(this.projects),this.fields=this.lang.fields(this.fields),this.selectedItemsList=this.selectedItemsList.filter(e=>e!==null),this.pages=this.request.getStat().pipe(d(e=>Object.values(e)[1].statistics.pages)),this.labels=this.searchInput.valueChanges.pipe(P(250),I(e=>{(!e||e.length===0)&&(this.items=[],this.isDisplay=!1,this.changeDetector.detectChanges())}),y(e=>{let o=e.endsWith("*")?e:e+"*",s=`https://database.factgrid.de/w/api.php?action=query&list=search&format=json&origin=*&srsearch=haswbstatement:P131=Q99677${o?" "+o:""}&srnamespace=120&srlimit=200`;return this.request.getItem(s).pipe(I(m=>console.log("R\xE9ponse CirrusSearch:",m)))}),d(e=>{if(!e.query||!e.query.search)return[];let o=e.query.search.map(s=>{let m=s.title.match(/Q\d+/);return m?m[0]:null}).filter(s=>!!s);return console.log("Q-ids extraits:",o),o}),T(e=>e.length>0),y(e=>{let o=this.lang.selectedLang,m=be(e,50).map(g=>{let f=`https://database.factgrid.de/w/api.php?action=wbgetentities&ids=${g.join("|")}&format=json&languages=${o}&origin=*`;return this.request.getItem(f).pipe(d(x=>x&&x.entities?Object.values(x.entities):[]))});return m.length>0?L(m).pipe(d(g=>g.flat())):w([])}),d(e=>{let o=(this.searchInput.value||"").toLowerCase(),s=this.lang.selectedLang;return e.filter(m=>{let g=m.labels?.[s]?.value?.toLowerCase()||"",M=(m.aliases?.[s]||[]).map(f=>f.value.toLowerCase());return o===""||g.includes(o)||M.some(f=>f.includes(o))})})).subscribe(e=>{this.items=this.setLanguage.item(e,this.lang.selectedLang),this.isDisplay=this.items.length>0,this.changeDetector.detectChanges()})}ngOnDestroy(){this.labels&&this.labels.unsubscribe()}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=k({type:t,selectors:[["app-prosopography-search"]],standalone:!0,features:[q],decls:21,vars:8,consts:[["href",D`https://fonts.googleapis.com/icon?family=Material+Icons`,"rel","stylesheet"],[1,"cardBackground"],[1,"HUTitle"],[1,"subTitle"],["appearance","outlined",1,"mat-elevation-z12"],[1,"search-center2"],["matInput","","placeholder","Ex. Goethe","value","Goethe",3,"formControl"],["align","end"],["class","warning",4,"ngIf"],[1,"search-center"],[1,"searchListSize"],[1,"warning"],[1,"details"],[1,"search-label"],[1,"internalLink",3,"routerLink"],["color","primary",3,"inline"],[3,"routerLink"],["href","https://database.factgrid.de/query/#%23model%0A%0ASELECT%20%3Fitem%20%3Fviewer%20%3FitemLabel%20%20WHERE%20%7B%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22%5BAUTO_LANGUAGE%5D%2Cen%22.%20%7D%0A%20%20%3Fitem%20wdt%3AP2%20wd%3AQ7%3B%0A%20%20%20%20%20%20%20%20wdt%3AP247%20wd%3AQ24708.%0A%20%20BIND%28STRAFTER%28STR%28%3Fitem%29%2C%20STR%28wd%3A%29%29%20AS%20%3FitemId%29%0A%20%20BIND%28IRI%28CONCAT%28%22https%3A%2F%2Fdatabase.factgrid.de%2Fviewer%2Fitem%2F%22%2C%20%3FitemId%29%29%20AS%20%3Fviewer%29%0A%7D%0A"],[1,"search-itemSelected"],["appearance","outlined",1,"search-itemSelected-mat-card"],[1,"selectedListTitle2"],[1,"selectedItemSize"],[1,"labelTitlePadding"],[1,"selectedItemText"],[1,"whiteButton",3,"inline"]],template:function(o,s){o&1&&(i(0,"head"),p(1,"link",0),n(),i(2,"body")(3,"div",1)(4,"div",2),r(5,"FactGrid"),n(),i(6,"div",3),r(7),n()(),i(8,"mat-card",4)(9,"mat-card-content")(10,"div")(11,"div",5)(12,"mat-form-field"),p(13,"input",6),i(14,"mat-hint",7),r(15),O(16,"async"),n()(),_(17,_e,2,1,"div",8),n()()(),i(18,"div",9),_(19,Ce,4,0,"div",10)(20,Ie,32,10,"div"),n()()()),o&2&&(a(7),C(s.subtitle),a(6),c("formControl",s.searchInput),a(2),h("",j(16,6,s.pages)," items"),a(2),c("ngIf",s.warningMessage),a(2),S(s.isDisplay==!0?19:-1),a(),S(s.isDisplay==!1?20:-1))},dependencies:[N,U,$,K,W,J,z,G,Q,V,me,ce,se,oe,le,re,Y,X,Z,ie,ee,te],styles:[".search-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.HU-div[_ngcontent-%COMP%]{height:150px;display:flex;align-items:center;justify-content:center}.HUTitle-div[_ngcontent-%COMP%]{padding-left:10px;color:#ad1457;font-weight:600;font-size:60px}.search-label[_ngcontent-%COMP%]{font-weight:700}.search-itemSelected[_ngcontent-%COMP%]{margin-top:50px}.selectedItemSize[_ngcontent-%COMP%]{font-size:14px}"]})}}return t})();export{Ke as ProsopographySearchComponent};
